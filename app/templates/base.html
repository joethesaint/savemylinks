<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SaveMyLinks - Your personal link curator and bookmark manager">
    <meta name="theme-color" content="#667eea">
    <title>{% block title %}SaveMyLinks{% endblock %}</title>
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Modern CSS Framework -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', path='/style.css') }}">
    
    <!-- Three.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.144.0/build/three.min.js"></script>
    
    <!-- Modern Clippy CSS is included in the JS module -->
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”—</text></svg>">
</head>
<body class="has-navbar-fixed-top">
    <!-- Particle Canvas -->
    <canvas id="particle-canvas"></canvas>
    
    <!-- Navigation -->
    <nav class="navbar is-fixed-top has-shadow" role="navigation" aria-label="main navigation">
        <div class="container">
            <div class="navbar-brand">
                <a class="navbar-item brand-logo" href="/">
                    <span class="icon is-medium">
                        <i class="fas fa-link"></i>
                    </span>
                    <strong class="ml-2">SaveMyLinks</strong>
                </a>
                
                <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasic">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>
            
            <div id="navbarBasic" class="navbar-menu">
                <div class="navbar-start">
                    <a class="navbar-item" href="/">
                        <span class="icon">
                            <i class="fas fa-home"></i>
                        </span>
                        <span>Home</span>
                    </a>
                    <a class="navbar-item" href="/add">
                        <span class="icon">
                            <i class="fas fa-plus"></i>
                        </span>
                        <span>Add Link</span>
                    </a>
                </div>
                
                <div class="navbar-end">
                    <div class="navbar-item">
                        <button id="theme-toggle" class="button is-ghost theme-toggle" title="Toggle theme">
                            <span class="icon">
                                <i id="theme-icon" class="fas fa-sun"></i>
                            </span>
                        </button>
                    </div>
                    <div class="navbar-item">
                        <div class="buttons">
                            <a class="button is-primary is-light" href="/add">
                                <strong>Add New Link</strong>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer mt-6">
        <div class="container">
            <div class="content has-text-centered">
                <div class="columns is-vcentered">
                    <div class="column">
                        <p class="is-size-6">
                            <strong>SaveMyLinks</strong> - Your personal link curator
                        </p>
                        <p class="is-size-7 has-text-grey">
                            Organize, search, and manage your bookmarks with ease
                        </p>
                    </div>
                    <div class="column is-narrow">
                        <div class="field is-grouped">
                            <p class="control">
                                <a class="button is-small is-outlined" href="https://github.com" target="_blank">
                                    <span class="icon">
                                        <i class="fab fa-github"></i>
                                    </span>
                                    <span>GitHub</span>
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript for mobile menu -->
    <script>
        // Mobile menu functionality
        document.addEventListener('DOMContentLoaded', () => {
            const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
            
            if ($navbarBurgers.length > 0) {
                $navbarBurgers.forEach(el => {
                    el.addEventListener('click', () => {
                        const target = el.dataset.target;
                        const $target = document.getElementById(target);
                        
                        el.classList.toggle('is-active');
                        $target.classList.toggle('is-active');
                    });
                });
            }
        });

        // Theme switching functionality
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const html = document.documentElement;
            
            // Check for saved theme preference or default to 'light'
            const currentTheme = localStorage.getItem('theme') || 'light';
            html.setAttribute('data-theme', currentTheme);
            updateThemeIcon(currentTheme);
            
            themeToggle.addEventListener('click', () => {
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                // Add animation class
                themeToggle.classList.add(newTheme === 'dark' ? 'dimming' : 'lighting');
                
                // Change theme after a short delay for animation
                setTimeout(() => {
                    html.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    updateThemeIcon(newTheme);
                    
                    // Remove animation class after animation completes
                    setTimeout(() => {
                        themeToggle.classList.remove('dimming', 'lighting');
                    }, 600);
                }, 100);
            });
            
            function updateThemeIcon(theme) {
                if (theme === 'dark') {
                    themeIcon.className = 'fas fa-moon';
                } else {
                    themeIcon.className = 'fas fa-sun';
                }
            }
            
            // Particle system with green dust effects
            const canvas = document.getElementById('particle-canvas');
            const ctx = canvas.getContext('2d');
            
            let particles = [];
            let mouse = { x: 0, y: 0 };
            
            // Particle class with enhanced green effects
            class Particle {
                constructor(x, y) {
                    this.x = x;
                    this.y = y;
                    this.vx = (Math.random() - 0.5) * 0.5;
                    this.vy = (Math.random() - 0.5) * 0.5;
                    this.size = Math.random() * 3 + 1;
                    this.opacity = Math.random() * 0.8 + 0.2;
                    this.hue = 120 + Math.random() * 60; // Green spectrum
                    this.life = Math.random() * 200 + 100;
                    this.maxLife = this.life;
                }
                
                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    
                    // Mouse interaction - stronger repulsion
                    const dx = this.x - mouse.x;
                    const dy = this.y - mouse.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 120) {
                        const force = (120 - distance) / 120;
                        this.vx += (dx / distance) * force * 0.3;
                        this.vy += (dy / distance) * force * 0.3;
                    }
                    
                    // Boundary bouncing
                    if (this.x < 0 || this.x > canvas.width) this.vx *= -0.8;
                    if (this.y < 0 || this.y > canvas.height) this.vy *= -0.8;
                    
                    // Keep particles in bounds
                    this.x = Math.max(0, Math.min(canvas.width, this.x));
                    this.y = Math.max(0, Math.min(canvas.height, this.y));
                    
                    // Friction
                    this.vx *= 0.99;
                    this.vy *= 0.99;
                    
                    // Life cycle
                    this.life--;
                    this.opacity = (this.life / this.maxLife) * 0.8;
                }
                
                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.opacity;
                    
                    // Glowing effect
                    const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size * 3);
                    gradient.addColorStop(0, `hsla(${this.hue}, 70%, 60%, 0.8)`);
                    gradient.addColorStop(0.5, `hsla(${this.hue}, 60%, 50%, 0.4)`);
                    gradient.addColorStop(1, `hsla(${this.hue}, 50%, 40%, 0)`);
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size * 3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Core particle
                    ctx.fillStyle = `hsla(${this.hue}, 80%, 70%, ${this.opacity})`;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.restore();
                }
            }
            
            function setCanvasSize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            
            function initParticles() {
                particles = [];
                const particleCount = Math.min(80, Math.floor((canvas.width * canvas.height) / 15000));
                
                for (let i = 0; i < particleCount; i++) {
                    particles.push(new Particle(
                        Math.random() * canvas.width,
                        Math.random() * canvas.height
                    ));
                }
            }
            
            function drawConnections() {
                for (let i = 0; i < particles.length; i++) {
                    for (let j = i + 1; j < particles.length; j++) {
                        const dx = particles[i].x - particles[j].x;
                        const dy = particles[i].y - particles[j].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 100) {
                            const opacity = (1 - distance / 100) * 0.3;
                            ctx.strokeStyle = `rgba(34, 197, 94, ${opacity})`;
                            ctx.lineWidth = 1;
                            ctx.beginPath();
                            ctx.moveTo(particles[i].x, particles[i].y);
                            ctx.lineTo(particles[j].x, particles[j].y);
                            ctx.stroke();
                        }
                    }
                }
            }
            
            function animateParticles() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Update and draw particles
                for (let i = particles.length - 1; i >= 0; i--) {
                    particles[i].update();
                    particles[i].draw();
                    
                    // Remove dead particles
                    if (particles[i].life <= 0) {
                        particles.splice(i, 1);
                    }
                }
                
                // Add new particles to maintain count
                while (particles.length < Math.min(80, Math.floor((canvas.width * canvas.height) / 15000))) {
                    particles.push(new Particle(
                        Math.random() * canvas.width,
                        Math.random() * canvas.height
                    ));
                }
                
                // Draw connections
                drawConnections();
                
                requestAnimationFrame(animateParticles);
            }
            
            // Mouse tracking with enhanced interaction
            document.addEventListener('mousemove', (e) => {
                mouse.x = e.clientX;
                mouse.y = e.clientY;
            });
            
            // Initialize particle system
            setCanvasSize();
            initParticles();
            animateParticles();
            
            // Handle window resize
            window.addEventListener('resize', () => {
                setCanvasSize();
                initParticles();
            });
        });
    </script>
    
    <!-- Clippy Assistant Scripts -->
    <!-- Modern Clippy Assistant Scripts - Loaded after main content -->
    <script type="module">
        let clippy;
        let randomMovementInterval;
        
        function startRandomAnimations() {
            if (randomMovementInterval) clearInterval(randomMovementInterval);
            
            randomMovementInterval = setInterval(() => {
                if (!clippy) return;
                
                // Use correct animation names from modern-clippy
                const animations = ['Idle', 'Wave', 'Thinking', 'Explain', 'GetAttention', 'Congratulate'];
                const randomAnimation = animations[Math.floor(Math.random() * animations.length)];
                
                clippy.play(randomAnimation);
                
                // Occasionally speak random messages
                if (Math.random() < 0.4) {
                    const messages = [
                        "Need any help?",
                        "I'm here if you need assistance!",
                        "Exploring the website?",
                        "Let me know if you have questions!",
                        "Looking good!",
                        "How's it going?",
                        "Anything I can help with?"
                    ];
                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    setTimeout(() => {
                        clippy.speak(randomMessage);
                    }, 500);
                }
            }, 3000 + Math.random() * 4000); // Faster interval between 3-7 seconds
        }
        
        async function initModernClippy() {
            try {
                // Dynamic import to load Clippy after main content
                const { initClippy } = await import('/static/modern-clippy.js');
                
                clippy = await initClippy({ basePath: '/static/' });
                
                // Add drag functionality
                let isDragging = false;
                let dragOffset = { x: 0, y: 0 };
                
                const clippyContainer = clippy.container;
                
                // Mouse down event
                clippyContainer.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    const rect = clippyContainer.getBoundingClientRect();
                    dragOffset.x = e.clientX - rect.left;
                    dragOffset.y = e.clientY - rect.top;
                    clippyContainer.style.cursor = 'grabbing';
                    
                    // Stop animations while dragging
                    if (randomMovementInterval) {
                        clearInterval(randomMovementInterval);
                        randomMovementInterval = null;
                    }
                    
                    e.preventDefault();
                });
                
                // Mouse move event
                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    
                    const newX = window.innerWidth - (e.clientX - dragOffset.x + clippyContainer.offsetWidth);
                    const newY = window.innerHeight - (e.clientY - dragOffset.y + clippyContainer.offsetHeight);
                    
                    // Keep within bounds
                    const boundedX = Math.max(20, Math.min(newX, window.innerWidth - 150));
                    const boundedY = Math.max(20, Math.min(newY, window.innerHeight - 120));
                    
                    clippyContainer.style.right = boundedX + 'px';
                    clippyContainer.style.bottom = boundedY + 'px';
                });
                
                // Mouse up event
                document.addEventListener('mouseup', () => {
                    if (isDragging) {
                        isDragging = false;
                        clippyContainer.style.cursor = 'grab';
                        
                        // Restart animations after a brief delay
                        setTimeout(() => {
                            if (!randomMovementInterval) {
                                startRandomAnimations();
                            }
                        }, 2000);
                    }
                });
                
                // Set initial cursor
                clippyContainer.style.cursor = 'grab';
                
                // Welcome message
                setTimeout(() => {
                    clippy.play('GetAttention');
                    setTimeout(() => {
                        clippy.speak("Hello! I'm your assistant. I'm here to help you navigate this website!");
                        // Start random animations after welcome
                        setTimeout(startRandomAnimations, 2000);
                    }, 500);
                }, 1000);
                
            } catch (error) {
                console.error('Failed to initialize Modern Clippy:', error);
            }
        }
        
        // Initialize after main content is fully loaded
        window.addEventListener('load', () => {
            // Add delay to ensure main content is prioritized
            setTimeout(initModernClippy, 1000);
        });
    </script>
    
</body>
</html>